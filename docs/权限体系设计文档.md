# 言意合一 - 权限体系设计文档

> 版本：v1.0
> 更新时间：2026-01-06
> 维护者：言意合一开发团队

---

## 目录

- [一、用户类型定义](#一用户类型定义)
- [二、前后端职责分工](#二前后端职责分工)
- [三、功能权限矩阵](#三功能权限矩阵)
- [四、权限常量定义](#四权限常量定义)
- [五、使用配额限制](#五使用配额限制)
- [六、AI 功能分层对比](#六ai-功能分层对比)
- [七、权限验证逻辑](#七权限验证逻辑)
- [八、权限提示文案](#八权限提示文案)
- [九、代码实现指南](#九代码实现指南)
- [十、附录](#十附录)

---

## 一、用户类型定义

### 1.1 用户类型

| 用户类型 | 说明 | 获取方式 | 权限级别 |
|---------|------|---------|---------|
| **游客** | 未登录用户 | 直接访问应用 | Level 1 |
| **登录用户** | 已注册/登录的免费用户 | 微信/抖音登录 | Level 2 |
| **会员用户** | 付费订阅用户 | 月度/年度/终身订阅 | Level 3 |

### 1.2 用户类型说明

#### 游客 (Guest)
- 无需注册即可使用基础功能
- 数据仅保存在本地
- 无法使用 AI 功能和云端存储

#### 登录用户 (Logged In User)
- 通过微信、抖音、手机号登录完成认证
- 可使用受限的 AI 功能（每日 10 次，但功能与会员一致）
- 可使用有限的云端存储（20 篇文章）
- 可自定义 AI 链接，但只能使用内置提示词模板

#### 会员用户 (Member)
- 付费订阅用户（月度/季度/年度）
- 不限制 AI 使用次数
- 不限制云端存储空间
- 可完全自定义 AI 配置
- 可使用最新的 AI 逻辑树决策模型
- 可使用高级 AI 功能（写作状态检测、情绪识别等）
- 可使用高级和自定义文字卡片模板

---

## 二、前后端职责分工

> 本章节详细说明权限系统中，哪些功能由客户端实现，哪些由服务端实现，以及如何协作。

### 2.1 职责分工总览

| 功能模块 | 客户端职责 | 服务端职责 | 数据一致性保证 |
|---------|-----------|-----------|--------------|
| **用户认证** | 存储Token<br>管理登录状态<br>Token刷新触发 | 验证登录凭证<br>签发JWT Token<br>刷新Token | Token统一由服务端签发和验证 |
| **会员状态** | 本地缓存会员信息<br>UI显示控制 | 会员信息查询<br>订阅状态验证<br>到期管理 | 启动时从服务端同步，定期刷新 |
| **AI 提示配额** | 实时计数显示<br>配额不足UI提示 | 配额真实计数<br>每日配额重置<br>并发控制 | 每次调用前后端双重校验，服务端为准 |
| **云端存储** | 本地文章缓存<br>离线编辑 | 文章云端存储<br>存储配额检查<br>数据同步 | 云端为唯一真实数据源 |
| **权限验证** | UI元素显隐控制<br>功能按钮灰度控制 | API访问权限验证<br>业务逻辑权限判断 | 服务端为最终权限决策者 |

---

### 2.2 详细职责分工表

#### 2.2.1 用户认证模块

| 功能点 | 客户端职责 | 服务端职责 | 备注 |
|-------|-----------|-----------|------|
| **微信登录** | 调用微信SDK获取code<br>打开授权页面 | 验证code<br>创建/更新用户<br>签发Token | Token由服务端统一签发 |
| **抖音登录** | 调用抖音SDK获取code<br>打开授权页面 | 验证code<br>创建/更新用户<br>签发Token | 同微信登录流程 |
| **Token存储** | 安全存储AccessToken/RefreshToken<br>管理Token过期时间 | - | 使用系统Keychain/Keystore |
| **Token刷新** | 检测Token即将过期（提前5分钟）<br>主动调用刷新接口 | 验证RefreshToken<br>签发新Token<br>作废旧Token | 无感刷新，用户无感知 |
| **登出** | 清除本地Token<br>清除用户缓存 | 作废当前Token<br>清理Session | 前后端都需清理 |

**协作流程：**
```
1. 客户端调用第三方SDK获取授权code
2. 客户端将code发送到服务端
3. 服务端验证code，签发Token
4. 客户端接收Token并存储
5. 后续请求携带Token
6. 服务端验证Token有效性
7. Token过期前，客户端主动刷新
```

---

#### 2.2.2 会员状态管理

| 功能点 | 客户端职责 | 服务端职责 | 备注 |
|-------|-----------|-----------|------|
| **会员信息查询** | 启动时查询会员状态<br>本地缓存会员信息 | 查询数据库<br>验证会员有效期<br>返回会员信息 | 首次启动必须从服务端获取 |
| **会员信息更新** | 监听会员变更<br>更新本地缓存 | 处理订阅/续费/取消<br>更新数据库<br>推送变更通知 | 支付成功后服务端推送 |
| **会员到期检测** | 检查本地过期时间<br>显示到期提示 | 实时验证会员有效性<br>到期自动降级 | 以服务端验证为准 |
| **会员等级展示** | 根据等级显示对应UI<br>显示剩余天数 | 维护等级定义<br>计算到期时间 | 等级定义由服务端控制 |

**协作流程：**
```
1. App启动 → 客户端请求会员信息
2. 服务端查询数据库 → 返回会员状态
3. 客户端缓存到本地
4. 用户进入需要权限的页面
5. 客户端先检查本地缓存（快速响应）
6. 关键操作时，客户端请求服务端验证（二次确认）
7. 会员状态变更时（支付/续费），服务端推送通知
8. 客户端收到通知，刷新本地缓存
```

---

#### 2.2.3 AI 提示配额管理

| 功能点 | 客户端职责 | 服务端职责 | 备注 |
|-------|-----------|-----------|------|
| **配额计数** | 本地维护今日使用次数<br>实时显示剩余次数 | 维护真实配额计数<br>记录每次使用 | 以服务端计数为准 |
| **配额重置** | 检测日期变化<br>重置本地计数 | 每日00:00自动重置<br>重置所有用户配额 | 服务端定时任务 |
| **配额检查** | 调用前先检查本地配额<br>配额不足直接提示 | 接收AI调用请求<br>验证用户配额<br>超限拒绝调用 | 前后端双重验证 |
| **配额扣减** | 乐观扣减本地计数<br>失败后回滚 | 原子扣减配额<br>记录使用日志<br>返回剩余次数 | 服务端保证原子性 |
| **会员不限次** | 检测到会员直接放行<br>不限次数显示 | 会员用户跳过配额检查<br>不计数 | 会员标记在服务端 |

**协作流程（登录用户）：**
```
1. 用户点击AI提示按钮
2. 客户端检查本地配额 → < 10次 → 继续调用
3. 客户端发起AI请求 → 携带Token
4. 服务端验证Token → 提取用户ID
5. 服务端检查配额 → 未超限 → 扣减计数
6. 服务端调用AI服务 → 返回结果
7. 客户端接收结果 → 展示给用户
8. 客户端更新本地计数 = 服务端返回值
```

**协作流程（会员用户）：**
```
1. 用户点击AI提示按钮
2. 客户端检查会员状态 → 是会员 → 直接调用
3. 客户端发起AI请求 → 携带Token
4. 服务端验证会员 → 确认会员身份
5. 服务端跳过配额检查 → 直接调用AI
6. 服务端返回结果（不扣减配额）
```

**异常处理：**
```
场景：客户端显示剩余3次，但服务端已用完
原因：用户在另一设备上使用
处理：
1. 服务端返回错误码：QUOTA_EXCEEDED
2. 客户端收到错误，同步服务端配额（0次）
3. 客户端显示配额提示："今日次数已用完，升级会员不限次数"
4. 引导用户升级会员
```

---

#### 2.2.4 云端存储管理

| 功能点 | 客户端职责 | 服务端职责 | 备注 |
|-------|-----------|-----------|------|
| **文章保存** | 编辑文章<br>调用保存接口<br>本地缓存文章 | 验证配额（登录20篇/会员不限）<br>保存到数据库<br>返回文章ID | 云端为唯一真实数据源 |
| **文章列表查询** | 展示文章列表<br>本地分页加载 | 查询用户文章<br>验证权限<br>返回分页数据 | 支持分页和搜索 |
| **文章删除** | 从本地列表移除<br>调用删除接口 | 验证所有权<br>软删除文章<br>返回成功状态 | 支持回收站功能 |
| **配额检查** | 保存前检查本地计数<br>超限提示 | 实时统计用户文章数<br>超限拒绝保存 | 以服务端统计为准 |
| **数据同步** | 检测本地修改<br>上传未同步文章 | 冲突检测<br>合并数据<br>返回最新数据 | 支持多设备同步 |

**协作流程（登录用户保存文章）：**
```
1. 用户编辑文章 → 点击保存
2. 客户端检查登录状态 → 已登录
3. 客户端检查会员状态 → 非会员
4. 客户端查询本地文章计数 → 19篇
5. 客户端判断可以保存 → 调用保存接口
6. 服务端验证Token → 提取用户ID
7. 服务端查询用户文章数 → 实时统计
8. 服务端检查配额 → ≤20篇 → 允许保存
9. 服务端保存到数据库 → 返回文章ID（第20篇）
10. 客户端接收成功 → 更新本地计数 = 20
```

**协作流程（超限场景）：**
```
1. 用户编辑文章 → 点击保存
2. 客户端检查本地计数 → 20篇 → 已满
3. 客户端直接弹窗提示："云端存储已满（20/20）<br>升级会员不限空间"
4. 用户选择：升级会员 / 删除旧文章 / 仅保存到本地
5. 如果选择"仅保存到本地" → 客户端本地存储
```

---

#### 2.2.5 权限验证流程

| 功能点 | 客户端职责 | 服务端职责 | 备注 |
|-------|-----------|-----------|------|
| **UI权限控制** | 根据权限显示/隐藏按钮<br>灰度不可用功能<br>显示升级提示 | - | 快速响应，提升体验 |
| **API权限验证** | - | 验证Token有效性<br>检查会员状态<br>验证功能权限<br>返回权限错误 | 安全保障，必须执行 |
| **配额验证** | 本地预检查<br>提前提示 | 实际配额扣减<br>超限拦截 | 双重验证 |
| **错误处理** | 接收权限错误码<br>展示友好提示 | 定义错误码规范<br>返回详细错误信息 | 统一错误码体系 |

**权限验证矩阵：**

| 场景 | 客户端验证 | 服务端验证 | 验证结果 |
|-----|-----------|-----------|---------|
| 游客访问AI功能 | ❌ 检测未登录 → 提示登录 | ❌ 返回401未授权 | ✅ 一致 |
| 登录用户AI次数用尽 | ✅ 检测本地配额=10 → 提示升级 | ✅ 服务端配额=10 → 返回429超限 | ✅ 一致 |
| 会员用户访问AI | ✅ 检测会员=true → 直接调用 | ✅ 验证会员有效 → 放行 | ✅ 一致 |
| 云端存储超限 | ⚠️ 本地计数可能不准 | ✅ 服务端实时统计 → 返回超限 | ⚠️ 以服务端为准 |

**错误码规范：**
```json
{
  "code": 403,
  "message": "权限不足",
  "error_type": "PERMISSION_DENIED",
  "required_permission": "aiPrompt",
  "current_membership": "free",
  "suggestion": "升级会员解锁AI功能（不限次数）"
}
```

---

### 2.3 数据同步策略

#### 2.3.1 启动时同步

```
App启动
  ↓
客户端检查本地会员信息
  ↓
判断是否需要刷新
  ├─ 距离上次刷新 < 1小时 → 使用本地缓存
  └─ 距离上次刷新 ≥ 1小时 → 请求服务端
       ↓
   服务端返回最新会员信息
       ↓
   客户端更新本地缓存
       ↓
   检查配额重置
       ↓
   如果日期变化 → 重置本地配额计数
```

#### 2.3.2 实时同步

| 触发场景 | 同步方式 | 数据来源 |
|---------|---------|---------|
| 支付成功 | 服务端推送通知（WebSocket/Push） | 服务端主动推送 |
| 手动刷新 | 客户端主动请求 | 下拉刷新 |
| 权限冲突 | 客户端收到错误码 | 错误响应中携带最新状态 |
| 定时刷新 | 后台定时任务（每小时） | 客户端轮询 |

---

### 2.4 安全机制

#### 2.4.1 客户端安全

| 机制 | 实现方式 | 作用 |
|-----|---------|------|
| **Token安全存储** | 使用iOS Keychain / Android Keystore | 防止Token泄露 |
| **HTTPS通信** | 所有API使用HTTPS | 防止中间人攻击 |
| **证书校验** | SSL Pinning证书校验 | 防止劫持 |
| **代码混淆** | Flutter/ProGuard混淆 | 防止逆向破解 |

#### 2.4.2 服务端安全

| 机制 | 实现方式 | 作用 |
|-----|---------|------|
| **Token签名** | JWT签名验证 | 防止Token伪造 |
| **Token过期** | 短期有效期（24小时） | 降低泄露风险 |
| **刷新Token机制** | RefreshToken独立验证 | 提升安全性 |
| **权限验证** | 每个接口都验证权限 | 防止越权访问 |
| **限流保护** | 同一用户请求频率限制 | 防止暴力攻击 |
| **日志审计** | 记录所有敏感操作 | 事后追溯 |

---

### 2.5 实现优先级

| 功能 | 客户端优先级 | 服务端优先级 | 说明 |
|-----|------------|-------------|------|
| **基础认证** | P0 | P0 | 必须首先实现 |
| **会员状态查询** | P0 | P0 | 核心功能 |
| **AI配额管理** | P0 | P0 | 核心业务逻辑 |
| **云端存储** | P0 | P0 | 核心功能 |
| **权限验证** | P0 | P0 | 安全保障 |
| **配额实时同步** | P1 | P1 | 多设备体验 |
| **会员推送通知** | P2 | P1 | 实时性提升 |
| **安全加固** | P1 | P1 | 生产环境必需 |

---

### 2.6 接口定义示例

#### 2.6.1 查询会员信息

**请求：**
```http
GET /api/v1/membership/status
Authorization: Bearer <access_token>
```

**响应：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "user_id": "123456",
    "level": "monthly",
    "level_display_name": "月度会员",
    "is_valid": true,
    "start_date": "2026-01-01T00:00:00Z",
    "expiry_date": "2026-02-01T00:00:00Z",
    "remaining_days": 26,
    "is_paid_member": true,
    "permissions": [
      "aiPrompt",
      "cloudStorage",
      "unlimitedAiPrompt",
      "unlimitedCloudStorage"
    ]
  }
}
```

#### 2.6.2 AI 调用接口

**请求：**
```http
POST /api/v1/ai/prompt
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "prompt": "帮我续写这段文章...",
  "article_id": "abc123"
}
```

**响应（成功）：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "result": "这是AI生成的续写内容...",
    "quota": {
      "used_today": 5,
      "remaining": 5,
      "limit": 10,
      "reset_time": "2026-01-07T00:00:00Z"
    }
  }
}
```

**响应（超限）：**
```json
{
  "code": 429,
  "message": "今日AI次数已用完",
  "error_type": "QUOTA_EXCEEDED",
  "data": {
    "quota": {
      "used_today": 10,
      "remaining": 0,
      "limit": 10,
      "reset_time": "2026-01-07T00:00:00Z"
    },
    "upgrade_url": "https://app.com/membership/upgrade"
  }
}
```

#### 2.6.3 保存文章接口

**请求：**
```http
POST /api/v1/articles
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "title": "文章标题",
  "content": "文章内容...",
  "tags": ["标签1", "标签2"]
}
```

**响应（成功）：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "article_id": "xyz789",
    "storage": {
      "used": 20,
      "limit": 20,
      "remaining": 0,
      "is_unlimited": false
    }
  }
}
```

**响应（超限）：**
```json
{
  "code": 403,
  "message": "云端存储已满（20/20）",
  "error_type": "STORAGE_QUOTA_EXCEEDED",
  "data": {
    "storage": {
      "used": 20,
      "limit": 20,
      "remaining": 0,
      "is_unlimited": false
    },
    "upgrade_url": "https://app.com/membership/upgrade"
  }
}
```

---

### 2.7 开发协作建议

#### 2.7.1 接口先行原则

1. **先定义接口文档** → 前后端基于Mock并行开发
2. **使用OpenAPI/Swagger** → 自动生成接口文档
3. **接口版本管理** → `/api/v1/`、`/api/v2/`
4. **统一响应格式** → 所有接口遵循相同规范

#### 2.7.2 错误处理规范

**客户端错误处理流程：**
```
1. 接收API响应
2. 检查code字段
3. 错误码分类处理：
   ├─ 401 Unauthorized → 跳转登录页
   ├─ 403 Forbidden → 显示权限提示
   ├─ 429 Quota Exceeded → 显示配额提示
   ├─ 500 Server Error → 显示错误提示
   └─ 其他错误 → 显示通用错误提示
```

**服务端错误码规范：**
```dart
enum ErrorCode {
  success(200, '成功'),
  unauthorized(401, '未登录或Token过期'),
  forbidden(403, '权限不足'),
  quotaExceeded(429, '配额已用完'),
  storageExceeded(403, '存储空间不足'),
  invalidRequest(400, '请求参数错误'),
  serverError(500, '服务器错误'),
}
```

#### 2.7.3 测试策略

| 测试类型 | 客户端测试 | 服务端测试 |
|---------|-----------|-----------|
| **单元测试** | 权限检查逻辑<br>配额管理逻辑 | 权限验证逻辑<br>配额扣减逻辑 |
| **集成测试** | API调用流程<br>错误处理流程 | API接口测试<br>权限验证流程 |
| **端到端测试** | 完整用户场景<br>多设备同步测试 | 完整业务流程<br>并发测试 |
| **安全测试** | Token存储安全<br>HTTPS通信 | Token验证<br>越权访问测试 |

---

## 三、功能权限矩阵

### 3.1 AI 功能模块

| 功能点 | 游客 | 登录用户 | 会员用户 | 详细说明 |
|-------|:----:|:-------:|:-------:|---------|
| **AI 提示** | ❌ | ✅ | ✅ | 登录：10次/天<br>会员：不限次 |
| **自定义 AI 链接** | ❌ | ✅ | ✅ | 登录：仅配置链接<br>会员：完全自定义 |
| **逻辑树决策模型** | ❌ | ❌ | ✅ | 会员专享最新模型 |
| **写作状态检测** | ❌ | ❌ | ✅ | 智能分析写作状态 |
| **情绪与意图识别** | ❌ | ❌ | ✅ | 识别用户创作情绪 |
| **卡点与需求推断** | ❌ | ❌ | ✅ | AI 推断创作卡点 |
| **引导策略匹配** | ❌ | ❌ | ✅ | 个性化创作引导 |

### 3.2 存储功能模块

| 功能点 | 游客 | 登录用户 | 会员用户 | 详细说明 |
|-------|:----:|:-------:|:-------:|---------|
| **云端存储** | ❌ | ✅ | ✅ | 登录：20篇文章<br>会员：不限 |
| **本地存储** | ✅ | ✅ | ✅ | 所有人都可使用本地存储 |
| **数据同步** | ❌ | ✅ | ✅ | 多设备数据同步 |

### 3.3 文字卡片功能

| 功能点 | 游客 | 登录用户 | 会员用户 | 详细说明 |
|-------|:----:|:-------:|:-------:|---------|
| **基础模板** | ✅ | ✅ | ✅ | 通用卡片样式（约 10 款） |
| **高级模板** | ❌ | ❌ | ✅ | 特殊设计、动效模板（约 20 款） |
| **自定义模板** | ❌ | ❌ | ✅ | 完全自定义卡片样式 |
| **模板导出** | ❌ | ❌ | ✅ | 导出自定义模板 |

### 3.4 文章创作功能

| 功能点 | 游客 | 登录用户 | 会员用户 | 详细说明 |
|-------|:----:|:-------:|:-------:|---------|
| **创建文章** | ✅ | ✅ | ✅ | 所有人不限 |
| **编辑文章** | ✅ | ✅ | ✅ | 所有人都可编辑 |
| **删除文章** | ✅ | ✅ | ✅ | 所有人都可删除 |
| **文章导出** | ❌ | ❌ | ✅ | 导出为 PDF/Markdown |

### 3.5 其他功能

| 功能点 | 游客 | 登录用户 | 会员用户 | 详细说明 |
|-------|:----:|:-------:|:-------:|---------|
| **浏览文章** | ✅ | ✅ | ✅ | 无限制 |
| **编辑个人资料** | ❌ | ✅ | ✅ | 登录后可编辑 |
| **数据统计** | ❌ | ❌ | ✅ | 详细的创作数据分析 |
| **优先客服** | ❌ | ❌ | ✅ | 专属客服支持 |
| **去除广告** | ❌ | ❌ | ✅ | 无广告体验 |

---

## 四、权限常量定义

### 4.1 权限枚举（建议代码结构）

```dart
/// 权限枚举
enum Permission {
  // ========== 基础功能（所有用户） ==========
  viewArticle,           // 浏览文章
  createArticle,         // 创建文章
  editArticle,           // 编辑文章
  deleteArticle,         // 删除文章
  useLocalStorage,       // 本地存储
  basicCardTemplate,     // 基础卡片模板

  // ========== 登录用户功能 ==========
  aiPrompt,              // AI 提示（每日限额 10 次）
  customAiLink,          // 自定义 AI 链接（限制模板）
  cloudStorage,          // 云端存储（限制 20 篇）
  editProfile,           // 编辑个人资料
  dataSync,              // 数据同步

  // ========== 会员专属功能 ==========
  // AI 相关
  unlimitedAiPrompt,     // 不限 AI 提示次数
  fullCustomAi,          // 完全自定义 AI（模型、参数等）
  advancedAiModel,       // 高级 AI 逻辑树决策模型
  writingStateDetection, // 写作状态检测
  emotionRecognition,    // 情绪与意图识别
  bottleneckInference,   // 卡点与需求推断
  guidanceMatching,      // 引导策略匹配

  // 存储相关
  unlimitedCloudStorage, // 不限云端存储数量
  exportArticle,         // 导出文章（PDF/Markdown）

  // 模板相关
  advancedCardTemplate,  // 高级卡片模板
  customCardTemplate,    // 自定义卡片模板
  exportCardTemplate,    // 导出卡片模板

  // 其他
  advancedStatistics,    // 高级数据统计
  prioritySupport,       // 优先客服支持
  removeAds,             // 去除广告
}
```

### 4.2 用户类型枚举

```dart
/// 用户类型枚举
enum UserType {
  guest,      // 游客
  loggedIn,   // 登录用户
  member,     // 会员用户
}
```

### 4.3 会员等级枚举（简化版）

```dart
/// 会员等级枚举
enum MembershipLevel {
  free,      // 免费用户（已登录）
  monthly,   // 月度会员
  yearly,    // 年度会员
  lifetime,  // 终身会员
}
```

---

## 五、使用配额限制

### 5.1 AI 提示配额

| 用户类型 | 日限额 | 计算方式 | 重置时间 | 超限处理 |
|---------|-------|---------|---------|---------|
| 游客 | 0 | - | - | 提示登录后可使用 |
| 登录用户 | 10次/天 | 每次调用 +1 | 每日 00:00 | 提示升级会员 |
| 会员用户 | ∞ | 不计数 | - | 无限制 |

### 5.2 云端存储配额

| 用户类型 | 文章数量限制 | 存储空间 | 超限处理 |
|---------|------------|---------|---------|
| 游客 | 0 | - | 仅可保存到本地 |
| 登录用户 | 20篇 | 基础云存储 | 提示升级会员或删除旧文章 |
| 会员用户 | ∞ | 不限云存储 | 无限制 |

### 5.3 配额管理数据结构

```dart
/// 用户配额信息
class UserQuota {
  final String userId;
  final int aiPromptUsedToday;      // 今日 AI 提示使用次数
  final DateTime? lastResetDate;    // 上次重置日期
  final int cloudArticleCount;      // 云端文章数量
  final DateTime? quotaResetTime;   // 配额重置时间

  // AI 提示是否可用
  bool get canUseAiPrompt => aiPromptUsedToday < 10;

  // 云端存储是否可用
  bool get canUseCloudStorage => cloudArticleCount < 20;
}
```

---

## 六、AI 功能分层对比

### 5.1 功能对比表

| 功能模块 | 登录用户 | 会员用户 | 差异说明 |
|---------|---------|---------|---------|
| **基础 AI 对话** | ✅ | ✅ | 无差异 |
| **提示词模板** | ✅（仅内置） | ✅（内置+自定义） | 会员可自定义 |
| **API 自定义** | ⚠️（仅链接） | ✅（完全自定义） | 登录用户受限 |
| **决策模型** | 基础版 | 最新版 | 会员使用最新模型 |
| **写作状态分析** | ❌ | ✅ | 会员专享 |
| **情绪识别** | ❌ | ✅ | 会员专享 |
| **卡点推断** | ❌ | ✅ | 会员专享 |
| **引导策略** | ❌ | ✅ | 会员专享 |

### 5.2 AI 模型差异

#### 登录用户 - 基础 AI 模型
- 简单的对话式 AI
- 预设提示词模板（约 10-20 个）
- 仅支持自定义 API 地址
- 不支持模型参数调整

#### 会员用户 - 高级 AI 模型
- 逻辑树决策模型（最新版）
- 写作状态检测：识别写作中/卡顿/完成等状态
- 情绪与意图识别：分析用户创作情绪和意图
- 卡点与需求推断：智能推断用户遇到的创作困难
- 引导策略匹配：根据状态自动匹配引导策略
- 完全自定义配置：模型选择、温度、最大 tokens 等

---

## 七、权限验证逻辑

### 6.1 AI 提示功能验证流程

```
用户点击 AI 提示按钮
    ↓
检查用户登录状态
    ├─ 未登录 → 弹窗提示："登录后可使用 AI 功能（每天免费 10 次）"
    └─ 已登录 → 继续
         ↓
     检查是否会员
         ├─ 是 → 直接调用 AI，不限次数
         └─ 否 → 继续
              ↓
          检查今日使用次数
              ├─ < 10 次 → 允许使用，次数 +1
              └─ ≥ 10 次 → 弹窗提示："今日 AI 次数已用完（10/10）<br>升级会员不限次数"
```

### 6.2 云端存储验证流程

```
用户创建/编辑文章并保存
    ↓
检查用户登录状态
    ├─ 未登录 → 仅保存到本地存储
    └─ 已登录 → 继续
         ↓
     检查是否会员
         ├─ 是 → 保存到云端，不限数量
         └─ 否 → 继续
              ↓
          检查云端文章数量
              ├─ < 20 篇 → 允许保存到云端
              └─ ≥ 20 篇 → 弹窗提示："云端存储已满（20/20）<br>升级会员不限空间或删除旧文章"
```

### 6.3 自定义 AI 配置验证流程

```
用户打开 AI 配置页面
    ↓
检查用户登录状态
    ├─ 未登录 → 弹窗提示："登录后可自定义 AI 配置"
    └─ 已登录 → 继续
         ↓
     检查是否会员
         ├─ 是 → 显示完整自定义界面
         │   ├─ API 地址配置
         │   ├─ 模型选择
         │   ├─ 参数调整（温度、tokens）
         │   └─ 自定义提示词模板
         └─ 否 → 显示简化配置界面
             ├─ API 地址配置 ✅
             ├─ 内置提示词模板选择 ✅
             └─ 其他配置项（锁定）⛔ + 提示 "升级会员解锁完整功能"
```

### 6.4 文字卡片功能验证流程

```
用户打开文字卡片模板列表
    ↓
检查用户类型
    ├─ 游客 → 仅显示基础模板（约 10 款）
    ├─ 登录用户 → 仅显示基础模板（约 10 款）
    └─ 会员用户 → 显示全部模板
                  ├─ 基础模板 ✅
                  ├─ 高级模板 ✅
                  └─ 自定义模板 ✅

用户点击高级/自定义模板（非会员）
    ↓
弹窗提示："此模板为会员专享<br>升级会员解锁 30+ 高级模板"
```

---

## 八、权限提示文案

### 7.1 AI 功能提示文案

| 场景 | 用户类型 | 标题 | 内容 | 操作按钮 |
|-----|---------|-----|------|---------|
| AI 提示 | 游客 | 登录后可使用 AI 功能 | 每天免费 10 次，会员不限次数 | 去登录 |
| AI 提示 | 登录用户 | 今日次数已用完 | 今日 AI 次数已用完（10/10）<br>升级会员不限次数 | 升级会员 |
| 自定义 AI 配置 | 游客 | 登录后可自定义 AI | 登录后可配置自定义 AI 链接 | 去登录 |
| 自定义 AI 配置 | 登录用户 | 升级解锁完整功能 | 登录用户仅可配置 AI 链接<br>会员可完全自定义模型和参数 | 升级会员 |
| 高级 AI 功能 | 非会员 | 会员专享功能 | 升级会员解锁智能写作助手<br>• 写作状态检测<br>• 情绪与意图识别<br>• 卡点与需求推断<br>• 引导策略匹配 | 升级会员 |

### 7.2 云端存储提示文案

| 场景 | 用户类型 | 标题 | 内容 | 操作按钮 |
|-----|---------|-----|------|---------|
| 云端存储 | 游客 | 登录后可使用云端存储 | 免费用户可存 20 篇文章<br>会员不限空间 | 去登录 |
| 云端存储满额 | 登录用户 | 云端存储已满 | 云端存储已满（20/20）<br>升级会员不限空间或删除旧文章 | 升级会员 / 管理文章 |

### 7.3 文字卡片提示文案

| 场景 | 用户类型 | 标题 | 内容 | 操作按钮 |
|-----|---------|-----|------|---------|
| 高级模板 | 非会员 | 会员专享模板 | 此模板为会员专享<br>升级会员解锁 30+ 高级模板 | 升级会员 |
| 自定义模板 | 非会员 | 会员专享功能 | 会员可自定义卡片模板<br>创建独一无二的样式 | 升级会员 |

### 7.4 通用提示文案

| 场景 | 标题 | 内容 |
|-----|-----|------|
| 会员专属功能 | 会员专享功能 | 升级会员解锁全部高级功能 |
| 数据统计 | 会员专享 | 会员可查看详细的创作数据分析 |
| 导出功能 | 会员专享 | 会员可导出文章为 PDF 或 Markdown |

---

## 九、代码实现指南

### 8.1 文件结构

```
lib/
├── data/
│   └── models/
│       ├── membership.dart          # 会员模型（已存在）
│       ├── auth_user.dart           # 认证用户模型（已存在）
│       └── user_quota.dart          # 用户配额模型（新增）
├── utils/
│   ├── permissions.dart             # 权限检查工具（已存在，需扩展）
│   └── quota_manager.dart           # 配额管理器（新增）
├── providers/
│   ├── auth_provider.dart           # 认证 Provider（已存在）
│   ├── membership_provider.dart     # 会员 Provider（已存在，需扩展）
│   └── quota_provider.dart          # 配额 Provider（新增）
├── widgets/
│   └── membership/
│       ├── member_required_widget.dart    # 会员限制组件（已存在）
│       ├── quota_prompt_widget.dart       # 配额提示组件（新增）
│       └── ai_permission_banner.dart      # AI 权限提示横幅（新增）
└── constants/
    └── quota_limits.dart            # 配额限制常量（新增）
```

### 8.2 新增模型：UserQuota

```dart
/// 用户配额信息
class UserQuota {
  final String userId;
  final int aiPromptUsedToday;      // 今日 AI 提示使用次数
  final DateTime? lastResetDate;    // 上次重置日期
  final int cloudArticleCount;      // 云端文章数量

  const UserQuota({
    required this.userId,
    this.aiPromptUsedToday = 0,
    this.lastResetDate,
    this.cloudArticleCount = 0,
  });

  /// AI 提示是否可用（登录用户 10 次/天）
  bool get canUseAiPrompt => aiPromptUsedToday < 10;

  /// 云端存储是否可用（登录用户 20 篇）
  bool get canUseCloudStorage => cloudArticleCount < 20;

  /// AI 提示剩余次数
  int get aiPromptRemaining => 10 - aiPromptUsedToday;

  /// 云端存储剩余数量
  int get cloudStorageRemaining => 20 - cloudArticleCount;

  /// 从 JSON 创建
  factory UserQuota.fromJson(Map<String, dynamic> json) {
    return UserQuota(
      userId: json['userId'] as String,
      aiPromptUsedToday: json['aiPromptUsedToday'] as int? ?? 0,
      lastResetDate: json['lastResetDate'] != null
          ? DateTime.parse(json['lastResetDate'] as String)
          : null,
      cloudArticleCount: json['cloudArticleCount'] as int? ?? 0,
    );
  }

  /// 转换为 JSON
  Map<String, dynamic> toJson() {
    return {
      'userId': userId,
      'aiPromptUsedToday': aiPromptUsedToday,
      'lastResetDate': lastResetDate?.toIso8601String(),
      'cloudArticleCount': cloudArticleCount,
    };
  }

  /// 复制并更新
  UserQuota copyWith({
    String? userId,
    int? aiPromptUsedToday,
    DateTime? lastResetDate,
    int? cloudArticleCount,
  }) {
    return UserQuota(
      userId: userId ?? this.userId,
      aiPromptUsedToday: aiPromptUsedToday ?? this.aiPromptUsedToday,
      lastResetDate: lastResetDate ?? this.lastResetDate,
      cloudArticleCount: cloudArticleCount ?? this.cloudArticleCount,
    );
  }
}
```

### 8.3 新增工具类：QuotaManager

```dart
import '../data/models/user_quota.dart';
import '../core/services/local_storage_service.dart';
import '../core/constants/storage_keys.dart';

/// 配额管理器
/// 负责管理用户的使用配额（AI 次数、云存储等）
class QuotaManager {
  final LocalStorageService _storage;

  QuotaManager(this._storage);

  /// 检查是否需要重置每日配额
  Future<void> checkAndResetDailyQuota(String userId) async {
    final quota = await getUserQuota(userId);
    final now = DateTime.now();
    final today = DateTime(now.year, now.month, now.day);

    // 如果上次重置日期不是今天，重置配额
    if (quota.lastResetDate == null ||
        quota.lastResetDate!.isBefore(today)) {
      await resetDailyQuota(userId);
    }
  }

  /// 重置每日配额
  Future<void> resetDailyQuota(String userId) async {
    final quota = await getUserQuota(userId);
    final updated = quota.copyWith(
      aiPromptUsedToday: 0,
      lastResetDate: DateTime.now(),
    );
    await _saveUserQuota(updated);
  }

  /// 检查 AI 提示配额
  Future<bool> canUseAiPrompt(String userId) async {
    final quota = await getUserQuota(userId);
    return quota.canUseAiPrompt;
  }

  /// 增加 AI 提示使用次数
  Future<void> incrementAiPromptUsage(String userId) async {
    await checkAndResetDailyQuota(userId);
    final quota = await getUserQuota(userId);
    final updated = quota.copyWith(
      aiPromptUsedToday: quota.aiPromptUsedToday + 1,
    );
    await _saveUserQuota(updated);
  }

  /// 检查云端存储配额
  Future<bool> canSaveToCloud(String userId) async {
    final quota = await getUserQuota(userId);
    return quota.canUseCloudStorage;
  }

  /// 更新云端文章数量
  Future<void> updateCloudArticleCount(String userId, int count) async {
    final quota = await getUserQuota(userId);
    final updated = quota.copyWith(cloudArticleCount: count);
    await _saveUserQuota(updated);
  }

  /// 获取用户配额信息
  Future<UserQuota> getUserQuota(String userId) async {
    final json = await _storage.getJson(
      '${StorageKeys.userQuota}_$userId',
      (json) => UserQuota.fromJson(json),
    );
    return json ?? UserQuota(userId: userId);
  }

  /// 保存用户配额信息
  Future<void> _saveUserQuota(UserQuota quota) async {
    await _storage.setJson(
      '${StorageKeys.userQuota}_${quota.userId}',
      quota.toJson(),
    );
  }
}
```

### 8.4 扩展 MembershipProvider

在现有的 `MembershipProvider` 中添加配额相关方法：

```dart
class MembershipProvider extends ChangeNotifier {
  // ... 现有代码 ...

  /// 检查 AI 提示权限
  String? validateAiPrompt() {
    if (_membership == null) {
      return '请先登录';
    }

    if (!_membership!.isValid) {
      return '会员已过期，请续费';
    }

    // 会员可以无限制使用
    if (_membership!.level != MembershipLevel.free) {
      return null;
    }

    // 免费用户需要检查配额（通过 QuotaProvider）
    return null; // 实际检查在 QuotaProvider 中进行
  }

  /// 检查是否可以完全自定义 AI
  bool get canFullyCustomizeAi {
    return _membership?.level != MembershipLevel.free;
  }

  /// 检查是否可以使用高级 AI 功能
  bool get canUseAdvancedAi {
    return _membership?.level != MembershipLevel.free;
  }

  /// 获取 AI 提示显示名称
  String getAiPromptDisplayName() {
    if (_membership == null || _membership!.level == MembershipLevel.free) {
      return 'AI 提示（每天 10 次）';
    }
    return 'AI 提示（不限次数）';
  }

  /// 获取云端存储显示名称
  String getCloudStorageDisplayName() {
    if (_membership == null || _membership!.level == MembershipLevel.free) {
      return '云端存储（20 篇）';
    }
    return '云端存储（不限）';
  }
}
```

### 8.5 新增配额提示组件

```dart
import 'package:flutter/material.dart';
import '../../core/theme/app_colors.dart';

/// 配额提示组件
class QuotaPromptWidget extends StatelessWidget {
  final QuotaType type;
  final VoidCallback? onUpgradeTap;
  final VoidCallback? onLoginTap;

  const QuotaPromptWidget({
    super.key,
    required this.type,
    this.onUpgradeTap,
    this.onLoginTap,
  });

  @override
  Widget build(BuildContext context) {
    final isDark = Theme.of(context).brightness == Brightness.dark;

    return Container(
      padding: const EdgeInsets.all(16),
      margin: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: isDark ? AppColors.darkSurface : AppColors.lightSurface,
        borderRadius: BorderRadius.circular(12),
        border: Border.all(
          color: isDark
              ? AppColors.darkTextSecondary.withOpacity(0.3)
              : AppColors.lightTextSecondary.withOpacity(0.3),
        ),
      ),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          Icon(
            _getIcon(),
            size: 48,
            color: isDark ? AppColors.darkTextSecondary : AppColors.lightTextSecondary,
          ),
          const SizedBox(height: 16),
          Text(
            _getTitle(),
            style: TextStyle(
              fontSize: 18,
              fontWeight: FontWeight.bold,
              color: isDark ? AppColors.darkTextPrimary : AppColors.lightTextPrimary,
            ),
          ),
          const SizedBox(height: 8),
          Text(
            _getMessage(),
            textAlign: TextAlign.center,
            style: TextStyle(
              fontSize: 14,
              color: isDark ? AppColors.darkTextSecondary : AppColors.lightTextSecondary,
            ),
          ),
          const SizedBox(height: 16),
          Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: _buildButtons(context, isDark),
          ),
        ],
      ),
    );
  }

  IconData _getIcon() {
    switch (type) {
      case QuotaType.aiPrompt:
        return Icons.psychology;
      case QuotaType.cloudStorage:
        return Icons.cloud;
      case QuotaType.advancedAi:
        return Icons.auto_awesome;
      case QuotaType.customAi:
        return Icons.settings;
    }
  }

  String _getTitle() {
    switch (type) {
      case QuotaType.aiPrompt:
        return 'AI 提示';
      case QuotaType.cloudStorage:
        return '云端存储';
      case QuotaType.advancedAi:
        return '会员专享功能';
      case QuotaType.customAi:
        return '自定义 AI 配置';
    }
  }

  String _getMessage() {
    switch (type) {
      case QuotaType.aiPrompt:
        return '登录后可使用 AI 功能（每天免费 10 次）\n会员不限次数';
      case QuotaType.cloudStorage:
        return '登录后可使用云端存储（免费 20 篇）\n会员不限空间';
      case QuotaType.advancedAi:
        return '升级会员解锁智能写作助手\n• 写作状态检测\n• 情绪与意图识别\n• 卡点与需求推断';
      case QuotaType.customAi:
        return '登录用户仅可配置 AI 链接\n会员可完全自定义模型和参数';
    }
  }

  List<Widget> _buildButtons(BuildContext context, bool isDark) {
    switch (type) {
      case QuotaType.aiPrompt:
      case QuotaType.cloudStorage:
        return [
          if (onLoginTap != null)
            ElevatedButton(
              onPressed: onLoginTap,
              child: const Text('去登录'),
            ),
          if (onUpgradeTap != null) ...[
            const SizedBox(width: 8),
            ElevatedButton(
              onPressed: onUpgradeTap,
              style: ElevatedButton.styleFrom(
                backgroundColor: isDark ? AppColors.primaryDark : AppColors.primary,
              ),
              child: const Text('升级会员'),
            ),
          ],
        ];
      case QuotaType.advancedAi:
      case QuotaType.customAi:
        return [
          if (onUpgradeTap != null)
            ElevatedButton(
              onPressed: onUpgradeTap,
              style: ElevatedButton.styleFrom(
                backgroundColor: isDark ? AppColors.primaryDark : AppColors.primary,
              ),
              child: const Text('升级会员'),
            ),
        ];
    }
  }
}

/// 配额类型
enum QuotaType {
  aiPrompt,       // AI 提示
  cloudStorage,   // 云端存储
  advancedAi,     // 高级 AI 功能
  customAi,       // 自定义 AI 配置
}
```

### 8.6 扩展 Permission 枚举

在 `lib/data/models/membership.dart` 中扩展权限枚举：

```dart
/// 权限枚举
enum Permission {
  // ========== 基础功能（所有用户） ==========
  viewArticle,
  createArticle,
  editArticle,
  deleteArticle,
  useLocalStorage,
  basicCardTemplate,

  // ========== 登录用户功能 ==========
  aiPrompt,              // AI 提示（每日限额）
  customAiLink,          // 自定义 AI 链接（限制）
  cloudStorage,          // 云端存储（限制）
  editProfile,
  dataSync,

  // ========== 会员专属功能 ==========
  // AI 相关
  unlimitedAiPrompt,
  fullCustomAi,
  advancedAiModel,
  writingStateDetection,
  emotionRecognition,
  bottleneckInference,
  guidanceMatching,

  // 存储相关
  unlimitedCloudStorage,
  exportArticle,

  // 模板相关
  advancedCardTemplate,
  customCardTemplate,
  exportCardTemplate,

  // 其他
  advancedStatistics,
  prioritySupport,
  removeAds,
}
```

### 8.7 使用示例

#### 示例 1：AI 提示功能

```dart
class AiPromptButton extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final authProvider = context.watch<AuthProvider>();
    final membershipProvider = context.watch<MembershipProvider>();
    final quotaProvider = context.watch<QuotaProvider>();

    // 检查权限
    if (!authProvider.isAuthenticated) {
      return QuotaPromptWidget(
        type: QuotaType.aiPrompt,
        onLoginTap: () => _showLoginDialog(context),
        onUpgradeTap: () => _navigateToMembership(context),
      );
    }

    // 会员用户直接显示
    if (membershipProvider.isValidMember) {
      return ElevatedButton(
        onPressed: () => _callAi(context),
        child: const Text('AI 提示（不限次数）'),
      );
    }

    // 登录用户检查配额
    if (!quotaProvider.canUseAiPrompt) {
      return QuotaPromptWidget(
        type: QuotaType.aiPrompt,
        onUpgradeTap: () => _navigateToMembership(context),
      );
    }

    return ElevatedButton(
      onPressed: () => _callAi(context),
      child: Text('AI 提示（剩余 ${quotaProvider.aiPromptRemaining} 次）'),
    );
  }

  void _callAi(BuildContext context) async {
    final quotaProvider = context.read<QuotaProvider>();

    // 调用 AI
    await _callAiApi();

    // 增加使用次数
    await quotaProvider.incrementAiPromptUsage();
  }
}
```

#### 示例 2：云端存储

```dart
Future<void> saveArticle(BuildContext context, Article article) async {
  final authProvider = context.read<AuthProvider>();
  final membershipProvider = context.read<MembershipProvider>();
  final quotaProvider = context.read<QuotaProvider>();

  // 未登录仅保存到本地
  if (!authProvider.isAuthenticated) {
    await _saveToLocal(article);
    return;
  }

  // 会员用户直接保存到云端
  if (membershipProvider.isValidMember) {
    await _saveToCloud(article);
    return;
  }

  // 登录用户检查配额
  if (!await quotaProvider.canSaveToCloud(article.userId)) {
    showDialog(
      context: context,
      builder: (context) => QuotaPromptWidget(
        type: QuotaType.cloudStorage,
        onUpgradeTap: () => _navigateToMembership(context),
      ),
    );
    return;
  }

  // 保存到云端
  await _saveToCloud(article);
  await quotaProvider.updateCloudArticleCount(
    article.userId,
    (await quotaProvider.getCloudArticleCount(article.userId)) + 1,
  );
}
```

---

## 十、附录

### 9.1 价格体系

| 会员等级 | 价格（人民币） | 折合每月 | 性价比 |
|---------|--------------|---------|--------|
| 免费用户 | ¥0 | - | - |
| 月度会员 | ¥18/月 | ¥18 | 基准 |
| 年度会员 | ¥188/年 | ¥15.67 | **省 13%** |
| 终身会员 | ¥498（一次性） | - | 适合长期用户 |

### 9.2 功能对比总结表

| 功能类别 | 具体功能 | 游客 | 登录用户 | 会员用户 |
|---------|---------|:----:|:-------:|:-------:|
| **基础功能** | 浏览文章 | ✅ | ✅ | ✅ |
| | 创建/编辑/删除文章 | ✅ | ✅ | ✅ |
| | 本地存储 | ✅ | ✅ | ✅ |
| **AI 功能** | AI 提示（基础） | ❌ | ✅ 10次/天 | ✅ 不限 |
| | 自定义 AI 链接 | ❌ | ⚠️ 受限 | ✅ 完全 |
| | 高级 AI 模型 | ❌ | ❌ | ✅ |
| | 写作状态检测 | ❌ | ❌ | ✅ |
| | 情绪识别 | ❌ | ❌ | ✅ |
| | 卡点推断 | ❌ | ❌ | ✅ |
| | 引导策略 | ❌ | ❌ | ✅ |
| **存储功能** | 云端存储 | ❌ | ⚠️ 20篇 | ✅ 不限 |
| | 数据同步 | ❌ | ✅ | ✅ |
| **卡片功能** | 基础模板 | ✅ | ✅ | ✅ |
| | 高级模板 | ❌ | ❌ | ✅ |
| | 自定义模板 | ❌ | ❌ | ✅ |
| **其他功能** | 编辑个人资料 | ❌ | ✅ | ✅ |
| | 导出文章 | ❌ | ❌ | ✅ |
| | 高级统计 | ❌ | ❌ | ✅ |
| | 优先客服 | ❌ | ❌ | ✅ |
| | 去除广告 | ❌ | ❌ | ✅ |

图例：✅ 可用 | ⚠️ 受限 | ❌ 不可用

### 9.3 实现优先级建议

#### P0（核心功能，必须实现）
- ✅ 基础权限模型扩展
- ✅ AI 提示配额管理（10次/天）
- ✅ 云端存储配额管理（20篇）
- ✅ 权限验证逻辑
- ✅ 基础权限提示 UI

#### P1（重要功能，尽快实现）
- ⏳ 自定义 AI 配置分级
- ⏳ 高级 AI 功能权限控制
- ⏳ 文字卡片模板分级
- ⏳ 配额重置逻辑
- ⏳ 完善权限提示文案

#### P2（增强功能，逐步实现）
- ⏳ 数据统计功能
- ⏳ 文章导出功能
- ⏳ 自定义模板编辑器
- ⏳ 会员专属高级模板

#### P3（优化功能，后续迭代）
- ⏳ 使用配额可视化展示
- ⏳ 配额使用统计
- ⏳ 会员权益对比页面
- ⏳ 权限升级引导优化

### 9.4 技术要点

#### 配额管理
- 使用本地存储缓存配额信息
- 每日 00:00 自动重置 AI 配额
- 云端文章数量实时同步
- 支持离线配额检查

#### 权限验证
- 前端 UI 限制 + 后端 API 双重验证
- 权限检查集中在 Provider 层
- 组件化权限提示 UI
- 统一错误处理和提示

#### 性能优化
- 配额信息本地缓存，减少 API 调用
- 异步加载会员状态
- 懒加载权限提示组件
- 精确的监听范围，避免不必要的重建

### 9.5 测试场景

#### 功能测试
- [ ] 游客访问 AI 功能 → 提示登录
- [ ] 登录用户使用 AI 10 次后 → 提示升级
- [ ] 会员用户使用 AI → 无限制
- [ ] 登录用户云端存储满 20 篇 → 提示升级
- [ ] 会员用户云端存储 → 无限制
- [ ] 配额每日重置 → 次数恢复

#### 边界测试
- [ ] 网络异常时的权限处理
- [ ] Token 过期时的权限处理
- [ ] 本地缓存清理后的行为
- [ ] 并发请求时的配额扣减

#### UI 测试
- [ ] 权限提示文案正确显示
- [ ] 按钮交互正常
- [ ] 不同主题下的显示效果
- [ ] 弹窗动画流畅性

---

## 变更历史

| 版本 | 日期 | 变更内容 | 作者 |
|-----|------|---------|------|
| v1.0 | 2026-01-06 | 初始版本，定义权限体系 | Claude |

---

> 本文档为言意合一项目的权限体系设计规范，如有疑问或建议，请联系开发团队。
